{% assign current_variant = product.selected_or_first_available_variant %}


<style>
  .stock-label {
    font-size: 1rem;
    padding: 5px 10px;
    border-radius: 4px;
    display: inline-block;
    margin-top: 10px;
    font-weight: bold;
  }
  .in-stock {
    background-color: #C6F6D5;
    color: #2F855A;
  }
  .out-of-stock {
    background-color: #FED7D7;
    color: #9B2C2C;
  }

  .swiper-container {
    width: 100%;
  }
  

  /* Ajuste para el Swiper principal */
  .main-swiper {
    height: 500px;
    margin-bottom: 10px;
    position: relative;
    overflow: hidden;
  }

  .main-swiper img {
    width: 100%;
    height: 100%;
    object-fit: contain; /* Mantiene la imagen dentro de los límites sin distorsión */
  }

  .swiper-pagination-bullet {
    background-color: #2F855A; /* Color verde elegante para las paginaciones */
  }

  /* Ajustes para el Swiper de miniaturas */
  .thumb-swiper {
    height: 100px;
    overflow: hidden; /* Para asegurarte de que no se salga de los bordes */
    position: relative;
   
  }

  .thumb-swiper .swiper-slide {
    width: 100px;
    height: 100px;
    opacity: 0.7;
    cursor: pointer;
    transition: opacity 0.3s ease;
    border-radius: 10px;
    overflow: hidden;
    border: 2px solid transparent; /* Borde invisible por defecto */
    
  }

  /* Borde verde oscuro para la miniatura activa */
  .thumb-swiper .swiper-slide-thumb-active {
    opacity: 1;
    border-color: #22543D; /* Borde verde oscuro para la miniatura activa */
  }

  .thumb-swiper img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 10px;
  }

  /* Ajustes para los botones de navegación */
  .swiper-button-prev, .swiper-button-next {
    color: black;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 10;
  }

  .swiper-button-prev {
    left: 0;
  }

  .swiper-button-next {
    right: 0;
  }

</style>

<div class="container mx-auto px-4 py-8">
  <div class="flex flex-col md:flex-row -mx-4">
    <!-- Carrusel de imágenes -->
    <div class="md:w-1/2 px-4 mb-8 md:mb-0  py-5 rounded-lg ">
      <div class="swiper-container main-swiper mb-4">
        <div class="swiper-wrapper">
          {% for image in product.images %}
            <div class="swiper-slide">
              <img src="{{ image | img_url: '600x' }}" alt="{{ image.alt | escape }}">
            </div>
          {% endfor %}
        </div>
        <div class="swiper-pagination"></div>
      </div>

      <!-- Swiper de miniaturas sin navegación ni paginación -->
      <div class="swiper-container thumb-swiper">
        <div class="swiper-wrapper">
          {% for image in product.images %}
            <div class="swiper-slide">
              <img src="{{ image | img_url: '100x100', crop: 'center' }}" alt="{{ image.alt | escape }}">
            </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Información del producto -->
    <div class="md:w-1/2 px-4">
      <h1 class="text-3xl font-bold mb-4">{{ product.title }}</h1>
      <p id="product-price" class="text-2xl font-semibold mb-4">{{ current_variant.price | money }}</p>
      <p class="mb-6">{{ product.description }}</p>

      <form action="/cart/add" method="post" enctype="multipart/form-data" id="add-to-cart-form">
        <input type="hidden" name="id" id="product-select" value="{{ current_variant.id }}">
        
        <div class="mb-4">
          <label for="quantity" class="block mb-2">Cantidad:</label>
          <input type="number" id="quantity" name="quantity" value="1" min="1" class="w-20 px-2 py-1 border rounded">
        </div>

        {% for option in product.options_with_values %}
          <div class="mb-4">
            <label for="SingleOptionSelector-{{ forloop.index0 }}" class="block mb-2">
              {{ option.name }}
            </label>
            <select
              id="SingleOptionSelector-{{ forloop.index0 }}"
              data-index="option{{ forloop.index }}"
              class="single-option-selector w-full px-2 py-1 border rounded"
            >
              {% for value in option.values %}
                <option
                  value="{{ value | escape }}"
                  {% if option.selected_value == value %}selected="selected"{% endif %}
                >
                  {{ value }}
                </option>
              {% endfor %}
            </select>
          </div>
        {% endfor %}

        <div id="stock-label" class="stock-label mb-4"></div>

        <button type="submit" name="add" id="AddToCart" class="w-full bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600 transition duration-200">
          <span id="AddToCartText">Add to cart</span>
        </button>
      </form>
    </div>
  </div>
</div>


<script>
  var variants = [
    {% for variant in product.variants %}
      {
        id: {{ variant.id | json }},
        title: {{ variant.title | json }},
        options: {{ variant.options | json }},
        available: {{ variant.available | json }},
        inventory_quantity: {{ variant.inventory_quantity | json }},
        inventory_management: {{ variant.inventory_management | json }}
      }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ];

  function updateStockLabel(variant) {
    var stockLabel = document.getElementById('stock-label');
    var addToCartButton = document.getElementById('AddToCart');
    var addToCartText = document.getElementById('AddToCartText');

    if (variant && variant.available) {
      if (variant.inventory_management && variant.inventory_quantity > 0) {
        stockLabel.innerHTML = '<span class="in-stock">Stock disponible: ' + variant.inventory_quantity + '</span>';
      } else if (variant.inventory_management && variant.inventory_quantity <= 0 && variant.inventory_policy === 'continue') {
        stockLabel.innerHTML = '<span class="in-stock">Sin stock, pero puedes continuar comprando</span>';
      } else {
        stockLabel.innerHTML = '<span class="in-stock">Disponible</span>';
      }
      addToCartButton.disabled = false;
      addToCartText.textContent = 'Add to cart';
    } else {
      stockLabel.innerHTML = '<span class="out-of-stock">Fuera de stock</span>';
      addToCartButton.disabled = true;
      addToCartText.textContent = 'Sold Out';
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    var productSelect = document.getElementById('product-select');
    var quantityInput = document.getElementById('quantity');
    var singleOptionSelectors = document.querySelectorAll('.single-option-selector');

    function getSelectedVariant() {
      var selectedOptions = Array.from(singleOptionSelectors).map(select => select.value);
      return variants.find(variant => 
        variant.options.every(function(option, index) {
          return option === selectedOptions[index];
        })
      );
    }

    singleOptionSelectors.forEach(function(selector) {
      selector.addEventListener('change', function() {
        var selectedVariant = getSelectedVariant();
        if (selectedVariant) {
          productSelect.value = selectedVariant.id;
          updateStockLabel(selectedVariant);
        }
      });
    });

    var initialVariant = getSelectedVariant();
    updateStockLabel(initialVariant);

// Inicializar Swiper
var thumbSwiper = new Swiper('.thumb-swiper', {
  spaceBetween: 10,
  slidesPerView: 4.5, // Configuración predeterminada para pantallas medianas (md)

  breakpoints: {
    // Configuración para pantallas grandes (lg)
    1024: {
      slidesPerView: 4.5, // Mostrar 5.5 slides en pantallas grandes
    },
    // Configuración para pantallas pequeñas/móviles
    768: {
      slidesPerView: 3.5, // Mostrar 3.5 slides en pantallas móviles
    }
  },
  freeMode: true,
  watchSlidesVisibility: true,
  watchSlidesProgress: true,
});
    var mainSwiper = new Swiper('.main-swiper', {
      slidesPerView: 1,
      spaceBetween: 10,
      loop: true,
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
      thumbs: {
        swiper: thumbSwiper,
      },
    });
  });
</script>
