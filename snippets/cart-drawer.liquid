<div 
    x-show="openCart" 
    x-cloak
    @click.away="openCart = false" 
    x-transition:enter="transition ease-out duration-300 transform"
    x-transition:enter-start="translate-x-full"
    x-transition:enter-end="translate-x-0"
    x-transition:leave="transition ease-in duration-300 transform"
    x-transition:leave-start="translate-x-0"
    x-transition:leave-end="translate-x-full"
    class="fixed top-0 right-0 w-80 md:w-96 bg-white shadow-lg z-[100] h-full overflow-hidden"
    data-money-format="{{ shop.money_format }}"
>
    <div class="p-5 flex justify-between items-center bg-[#1D495B] text-white">
        <h2 class="text-lg font-semibold">Your cart</h2>
        <button @click="openCart = false" class="text-white hover:text-gray-300">
            {% render 'icon-close' %}
        </button>
    </div>

    <!-- Contenido del carrito -->
    <div class="p-5">
        <p class="text-sm text-yellow-500">You are eligible for free shipping!</p>
        <div class="mt-4">
            <p>Total: <strong id="cart-drawer-total">{{ cart.total_price | money }}</strong></p>
            <label class="block mt-2">
                <input type="checkbox" class="mr-2"> I have read and agree to the <a href="#" class="text-blue-500">Privacy Policy</a>.
            </label>
            <div class="flex mt-4">
                <button class="bg-yellow-500 text-white px-6 py-2 rounded mr-2 w-full">View cart</button>
                <button class="bg-green-500 text-white px-6 py-2 rounded w-full">Check out</button>
            </div>
        </div>
    </div>

    <!-- Lista de productos en el carrito con scroll -->
    <form action="/cart" method="post" class="grid grid-cols-1 lg:grid-cols-3 gap-6" id="cart-form">
      <!-- Tabla de productos del carrito -->
      <div class="lg:col-span-2 overflow-x-auto">
        <table class="min-w-full bg-white border rounded-lg">
          <tbody>
            <!-- Iterar sobre los items del carrito -->
            {% for item in cart.items %}
            <tr class="border-b last:border-none" data-key="{{ item.key }}">
              <!-- Columna del producto -->
              <td class="py-4">
                <div class="flex flex-col sm:flex-row items-center sm:space-x-4 space-y-4 sm:space-y-0">
                  <img src="{{ item.image | img_url: 'medium' }}" alt="{{ item.title }}" class="w-24 h-24 object-cover">
                  <div class="text-center sm:text-left">
                    <h3 class="text-lg font-semibold">{{ item.product.title }}</h3>
                    <p class="text-sm text-gray-500">{{ item.variant.title }}</p>
                    <p class="text-xs text-gray-400">Model: {{ item.sku }}</p>
                    <p class="text-sm font-semibold mt-2 item-price">{{ item.price | money }}</p>
                  </div>
                </div>
              </td>
              <!-- Columna de la cantidad -->
              <td class="py-4 text-center">
                <div class="flex items-center justify-center space-x-2">
                  <button type="button" 
                          class="w-8 h-8 flex items-center justify-center border border-gray-300 rounded-full text-gray-500 hover:bg-gray-200 focus:outline-none btn-decrease" 
                          data-key="{{ item.key }}" 
                          data-stock="{% if item.variant.inventory_management %}{{ item.variant.inventory_quantity }}{% else %}''{% endif %}">
                    <span class="text-lg font-bold leading-none">-</span>
                  </button>
                  <input type="number" 
                         name="updates[{{ item.key }}]" 
                         value="{{ item.quantity }}" 
                         min="0" 
                         max="{% if item.variant.inventory_management %}{{ item.variant.inventory_quantity }}{% else %}''{% endif %}" 
                         class="w-12 h-8 text-center border border-gray-300 rounded outline-none focus:ring focus:ring-gray-300 item-quantity" 
                         data-key="{{ item.key }}" 
                         data-stock="{% if item.variant.inventory_management %}{{ item.variant.inventory_quantity }}{% else %}''{% endif %}">
                  <button type="button" 
                          class="w-8 h-8 flex items-center justify-center border border-gray-300 rounded-full text-gray-500 hover:bg-gray-200 focus:outline-none btn-increase" 
                          data-key="{{ item.key }}" 
                          data-stock="{% if item.variant.inventory_management %}{{ item.variant.inventory_quantity }}{% else %}''{% endif %}">
                    <span class="text-lg font-bold leading-none">+</span>
                  </button>
                </div>
              </td>
              <!-- Columna para eliminar el producto y mostrar subtotal -->
              <td class="py-4 text-center sm:text-right">
                <div class="flex flex-col sm:flex-row justify-between sm:items-center space-y-4 sm:space-y-0 sm:space-x-3">
                  <button type="button" class="text-gray-500 hover:text-red-700 btn-remove" data-key="{{ item.key }}">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                  </button>
                  <span class="item-subtotal" data-key="{{ item.key }}">{{ item.line_price | money }}</span>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
{{ 'cart.js' | asset_url | script_tag }}
